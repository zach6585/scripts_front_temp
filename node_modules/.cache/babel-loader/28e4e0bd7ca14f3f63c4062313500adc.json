{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.initMessageListener = exports.initStateWithPrevTab = exports.withReduxStateSync = exports.createReduxStateSync = exports.createStateSyncMiddleware = undefined;\nexports.generateUuidForAction = generateUuidForAction;\nexports.isActionAllowed = isActionAllowed;\nexports.isActionSynced = isActionSynced;\nexports.MessageListener = MessageListener;\n\nvar _broadcastChannel = require('broadcast-channel');\n\nvar lastUuid = 0;\nvar GET_INIT_STATE = '&_GET_INIT_STATE';\nvar SEND_INIT_STATE = '&_SEND_INIT_STATE';\nvar RECEIVE_INIT_STATE = '&_RECEIVE_INIT_STATE';\nvar INIT_MESSAGE_LISTENER = '&_INIT_MESSAGE_LISTENER';\nvar defaultConfig = {\n  channel: 'redux_state_sync',\n  predicate: null,\n  blacklist: [],\n  whitelist: [],\n  broadcastChannelOption: undefined,\n  prepareState: function prepareState(state) {\n    return state;\n  }\n};\n\nvar getIniteState = function getIniteState() {\n  return {\n    type: GET_INIT_STATE\n  };\n};\n\nvar sendIniteState = function sendIniteState() {\n  return {\n    type: SEND_INIT_STATE\n  };\n};\n\nvar receiveIniteState = function receiveIniteState(state) {\n  return {\n    type: RECEIVE_INIT_STATE,\n    payload: state\n  };\n};\n\nvar initListener = function initListener() {\n  return {\n    type: INIT_MESSAGE_LISTENER\n  };\n};\n\nfunction s4() {\n  return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n}\n\nfunction guid() {\n  return '' + s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n} // generate current window unique id\n\n\nvar WINDOW_STATE_SYNC_ID = guid(); // export for test\n\nfunction generateUuidForAction(action) {\n  var stampedAction = action;\n  stampedAction.$uuid = guid();\n  stampedAction.$wuid = WINDOW_STATE_SYNC_ID;\n  return stampedAction;\n} // export for test\n\n\nfunction isActionAllowed(_ref) {\n  var predicate = _ref.predicate,\n      blacklist = _ref.blacklist,\n      whitelist = _ref.whitelist;\n\n  var allowed = function allowed() {\n    return true;\n  };\n\n  if (predicate && typeof predicate === 'function') {\n    allowed = predicate;\n  } else if (Array.isArray(blacklist)) {\n    allowed = function allowed(action) {\n      return blacklist.indexOf(action.type) < 0;\n    };\n  } else if (Array.isArray(whitelist)) {\n    allowed = function allowed(action) {\n      return whitelist.indexOf(action.type) >= 0;\n    };\n  }\n\n  return allowed;\n} // export for test\n\n\nfunction isActionSynced(action) {\n  return !!action.$isSync;\n} // export for test\n\n\nfunction MessageListener(_ref2) {\n  var channel = _ref2.channel,\n      dispatch = _ref2.dispatch,\n      allowed = _ref2.allowed;\n  var isSynced = false;\n  var tabs = {};\n\n  this.handleOnMessage = function (stampedAction) {\n    // Ignore if this action is triggered by this window\n    if (stampedAction.$wuid === WINDOW_STATE_SYNC_ID) {\n      return;\n    } // IE bug https://stackoverflow.com/questions/18265556/why-does-internet-explorer-fire-the-window-storage-event-on-the-window-that-st\n\n\n    if (stampedAction.type === RECEIVE_INIT_STATE) {\n      return;\n    } // ignore other values that saved to localstorage.\n\n\n    if (stampedAction.$uuid && stampedAction.$uuid !== lastUuid) {\n      if (stampedAction.type === GET_INIT_STATE && !tabs[stampedAction.$wuid]) {\n        tabs[stampedAction.$wuid] = true;\n        dispatch(sendIniteState());\n      } else if (stampedAction.type === SEND_INIT_STATE && !tabs[stampedAction.$wuid]) {\n        if (!isSynced) {\n          isSynced = true;\n          dispatch(receiveIniteState(stampedAction.payload));\n        }\n      } else if (allowed(stampedAction)) {\n        lastUuid = stampedAction.$uuid;\n        dispatch(Object.assign(stampedAction, {\n          $isSync: true\n        }));\n      }\n    }\n  };\n\n  this.messageChannel = channel;\n  this.messageChannel.onmessage = this.handleOnMessage;\n}\n\nvar createStateSyncMiddleware = exports.createStateSyncMiddleware = function createStateSyncMiddleware() {\n  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultConfig;\n  var allowed = isActionAllowed(config);\n  var channel = new _broadcastChannel.BroadcastChannel(config.channel, config.broadcastChannelOption);\n  var prepareState = config.prepareState || defaultConfig.prepareState;\n  var messageListener = null;\n  return function (_ref3) {\n    var getState = _ref3.getState,\n        dispatch = _ref3.dispatch;\n    return function (next) {\n      return function (action) {\n        // create message receiver\n        if (!messageListener) {\n          messageListener = new MessageListener({\n            channel: channel,\n            dispatch: dispatch,\n            allowed: allowed\n          });\n        } // post messages\n\n\n        if (action && !action.$uuid) {\n          var stampedAction = generateUuidForAction(action);\n          lastUuid = stampedAction.$uuid;\n\n          try {\n            if (action.type === SEND_INIT_STATE) {\n              if (getState()) {\n                stampedAction.payload = prepareState(getState());\n                channel.postMessage(stampedAction);\n              }\n\n              return next(action);\n            }\n\n            if (allowed(stampedAction) || action.type === GET_INIT_STATE) {\n              channel.postMessage(stampedAction);\n            }\n          } catch (e) {\n            console.error(\"Your browser doesn't support cross tab communication\");\n          }\n        }\n\n        return next(Object.assign(action, {\n          $isSync: typeof action.$isSync === 'undefined' ? false : action.$isSync\n        }));\n      };\n    };\n  };\n}; // eslint-disable-next-line max-len\n\n\nvar createReduxStateSync = exports.createReduxStateSync = function createReduxStateSync(appReducer) {\n  var prepareState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultConfig.prepareState;\n  return function (state, action) {\n    var initState = state;\n\n    if (action.type === RECEIVE_INIT_STATE) {\n      initState = prepareState(action.payload);\n    }\n\n    return appReducer(initState, action);\n  };\n}; // init state with other tab's state\n\n\nvar withReduxStateSync = exports.withReduxStateSync = createReduxStateSync;\n\nvar initStateWithPrevTab = exports.initStateWithPrevTab = function initStateWithPrevTab(_ref4) {\n  var dispatch = _ref4.dispatch;\n  dispatch(getIniteState());\n};\n/*\nif don't dispath any action, the store.dispath will not be available for message listener.\ntherefor need to trigger an empty action to init the messageListener.\n\nhowever, if already using initStateWithPrevTab, this function will be redundant\n*/\n\n\nvar initMessageListener = exports.initMessageListener = function initMessageListener(_ref5) {\n  var dispatch = _ref5.dispatch;\n  dispatch(initListener());\n};","map":{"version":3,"sources":["/mnt/c/Users/moust/Documents/Scripts/frontend/node_modules/redux-state-sync/dist/syncState.js"],"names":["Object","defineProperty","exports","value","initMessageListener","initStateWithPrevTab","withReduxStateSync","createReduxStateSync","createStateSyncMiddleware","undefined","generateUuidForAction","isActionAllowed","isActionSynced","MessageListener","_broadcastChannel","require","lastUuid","GET_INIT_STATE","SEND_INIT_STATE","RECEIVE_INIT_STATE","INIT_MESSAGE_LISTENER","defaultConfig","channel","predicate","blacklist","whitelist","broadcastChannelOption","prepareState","state","getIniteState","type","sendIniteState","receiveIniteState","payload","initListener","s4","Math","floor","random","toString","substring","guid","WINDOW_STATE_SYNC_ID","action","stampedAction","$uuid","$wuid","_ref","allowed","Array","isArray","indexOf","$isSync","_ref2","dispatch","isSynced","tabs","handleOnMessage","assign","messageChannel","onmessage","config","arguments","length","BroadcastChannel","messageListener","_ref3","getState","next","postMessage","e","console","error","appReducer","initState","_ref4","_ref5"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.initMessageListener = exports.initStateWithPrevTab = exports.withReduxStateSync = exports.createReduxStateSync = exports.createStateSyncMiddleware = undefined;\nexports.generateUuidForAction = generateUuidForAction;\nexports.isActionAllowed = isActionAllowed;\nexports.isActionSynced = isActionSynced;\nexports.MessageListener = MessageListener;\n\nvar _broadcastChannel = require('broadcast-channel');\n\nvar lastUuid = 0;\nvar GET_INIT_STATE = '&_GET_INIT_STATE';\nvar SEND_INIT_STATE = '&_SEND_INIT_STATE';\nvar RECEIVE_INIT_STATE = '&_RECEIVE_INIT_STATE';\nvar INIT_MESSAGE_LISTENER = '&_INIT_MESSAGE_LISTENER';\n\nvar defaultConfig = {\n    channel: 'redux_state_sync',\n    predicate: null,\n    blacklist: [],\n    whitelist: [],\n    broadcastChannelOption: undefined,\n    prepareState: function prepareState(state) {\n        return state;\n    }\n};\n\nvar getIniteState = function getIniteState() {\n    return { type: GET_INIT_STATE };\n};\nvar sendIniteState = function sendIniteState() {\n    return { type: SEND_INIT_STATE };\n};\nvar receiveIniteState = function receiveIniteState(state) {\n    return { type: RECEIVE_INIT_STATE, payload: state };\n};\nvar initListener = function initListener() {\n    return { type: INIT_MESSAGE_LISTENER };\n};\n\nfunction s4() {\n    return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n}\n\nfunction guid() {\n    return '' + s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n}\n\n// generate current window unique id\nvar WINDOW_STATE_SYNC_ID = guid();\n// export for test\nfunction generateUuidForAction(action) {\n    var stampedAction = action;\n    stampedAction.$uuid = guid();\n    stampedAction.$wuid = WINDOW_STATE_SYNC_ID;\n    return stampedAction;\n}\n// export for test\nfunction isActionAllowed(_ref) {\n    var predicate = _ref.predicate,\n        blacklist = _ref.blacklist,\n        whitelist = _ref.whitelist;\n\n    var allowed = function allowed() {\n        return true;\n    };\n\n    if (predicate && typeof predicate === 'function') {\n        allowed = predicate;\n    } else if (Array.isArray(blacklist)) {\n        allowed = function allowed(action) {\n            return blacklist.indexOf(action.type) < 0;\n        };\n    } else if (Array.isArray(whitelist)) {\n        allowed = function allowed(action) {\n            return whitelist.indexOf(action.type) >= 0;\n        };\n    }\n    return allowed;\n}\n// export for test\nfunction isActionSynced(action) {\n    return !!action.$isSync;\n}\n// export for test\nfunction MessageListener(_ref2) {\n    var channel = _ref2.channel,\n        dispatch = _ref2.dispatch,\n        allowed = _ref2.allowed;\n\n    var isSynced = false;\n    var tabs = {};\n    this.handleOnMessage = function (stampedAction) {\n        // Ignore if this action is triggered by this window\n        if (stampedAction.$wuid === WINDOW_STATE_SYNC_ID) {\n            return;\n        }\n        // IE bug https://stackoverflow.com/questions/18265556/why-does-internet-explorer-fire-the-window-storage-event-on-the-window-that-st\n        if (stampedAction.type === RECEIVE_INIT_STATE) {\n            return;\n        }\n        // ignore other values that saved to localstorage.\n        if (stampedAction.$uuid && stampedAction.$uuid !== lastUuid) {\n            if (stampedAction.type === GET_INIT_STATE && !tabs[stampedAction.$wuid]) {\n                tabs[stampedAction.$wuid] = true;\n                dispatch(sendIniteState());\n            } else if (stampedAction.type === SEND_INIT_STATE && !tabs[stampedAction.$wuid]) {\n                if (!isSynced) {\n                    isSynced = true;\n                    dispatch(receiveIniteState(stampedAction.payload));\n                }\n            } else if (allowed(stampedAction)) {\n                lastUuid = stampedAction.$uuid;\n                dispatch(Object.assign(stampedAction, {\n                    $isSync: true\n                }));\n            }\n        }\n    };\n    this.messageChannel = channel;\n    this.messageChannel.onmessage = this.handleOnMessage;\n}\n\nvar createStateSyncMiddleware = exports.createStateSyncMiddleware = function createStateSyncMiddleware() {\n    var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultConfig;\n\n    var allowed = isActionAllowed(config);\n    var channel = new _broadcastChannel.BroadcastChannel(config.channel, config.broadcastChannelOption);\n    var prepareState = config.prepareState || defaultConfig.prepareState;\n    var messageListener = null;\n\n    return function (_ref3) {\n        var getState = _ref3.getState,\n            dispatch = _ref3.dispatch;\n        return function (next) {\n            return function (action) {\n                // create message receiver\n                if (!messageListener) {\n                    messageListener = new MessageListener({ channel: channel, dispatch: dispatch, allowed: allowed });\n                }\n                // post messages\n                if (action && !action.$uuid) {\n                    var stampedAction = generateUuidForAction(action);\n                    lastUuid = stampedAction.$uuid;\n                    try {\n                        if (action.type === SEND_INIT_STATE) {\n                            if (getState()) {\n                                stampedAction.payload = prepareState(getState());\n                                channel.postMessage(stampedAction);\n                            }\n                            return next(action);\n                        }\n                        if (allowed(stampedAction) || action.type === GET_INIT_STATE) {\n                            channel.postMessage(stampedAction);\n                        }\n                    } catch (e) {\n                        console.error(\"Your browser doesn't support cross tab communication\");\n                    }\n                }\n                return next(Object.assign(action, {\n                    $isSync: typeof action.$isSync === 'undefined' ? false : action.$isSync\n                }));\n            };\n        };\n    };\n};\n\n// eslint-disable-next-line max-len\nvar createReduxStateSync = exports.createReduxStateSync = function createReduxStateSync(appReducer) {\n    var prepareState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultConfig.prepareState;\n    return function (state, action) {\n        var initState = state;\n        if (action.type === RECEIVE_INIT_STATE) {\n            initState = prepareState(action.payload);\n        }\n        return appReducer(initState, action);\n    };\n};\n\n// init state with other tab's state\nvar withReduxStateSync = exports.withReduxStateSync = createReduxStateSync;\n\nvar initStateWithPrevTab = exports.initStateWithPrevTab = function initStateWithPrevTab(_ref4) {\n    var dispatch = _ref4.dispatch;\n\n    dispatch(getIniteState());\n};\n\n/*\nif don't dispath any action, the store.dispath will not be available for message listener.\ntherefor need to trigger an empty action to init the messageListener.\n\nhowever, if already using initStateWithPrevTab, this function will be redundant\n*/\nvar initMessageListener = exports.initMessageListener = function initMessageListener(_ref5) {\n    var dispatch = _ref5.dispatch;\n\n    dispatch(initListener());\n};"]},"metadata":{},"sourceType":"script"}